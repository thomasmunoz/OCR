<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDP Pipeline - Code Quality Audit Report</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
        }
        .subtitle {
            opacity: 0.9;
            font-size: 1.1em;
        }
        .summary {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .severity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .severity-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .severity-critical { border-left-color: #e74c3c; }
        .severity-high { border-left-color: #e67e22; }
        .severity-medium { border-left-color: #f39c12; }
        .severity-low { border-left-color: #3498db; }
        .severity-info { border-left-color: #95a5a6; }

        .severity-card h3 {
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .severity-count {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        .file-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .file-section h2 {
            margin-top: 0;
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .issue {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }
        .issue-critical { border-left-color: #e74c3c; }
        .issue-high { border-left-color: #e67e22; }
        .issue-medium { border-left-color: #f39c12; }
        .issue-low { border-left-color: #3498db; }
        .issue-info { border-left-color: #95a5a6; }

        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .issue-title {
            font-weight: bold;
            font-size: 1.1em;
        }
        .severity-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            color: white;
        }
        .badge-critical { background: #e74c3c; }
        .badge-high { background: #e67e22; }
        .badge-medium { background: #f39c12; }
        .badge-low { background: #3498db; }
        .badge-info { background: #95a5a6; }

        .location {
            color: #666;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin-bottom: 8px;
        }
        .description {
            color: #555;
            margin-bottom: 10px;
        }
        .action {
            background: #e8f4f8;
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #3498db;
            font-size: 0.95em;
        }
        .action strong {
            color: #2980b9;
        }
        .code-snippet {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 10px 0;
        }
        .recommendations {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            border-left: 5px solid #4caf50;
        }
        .recommendations h3 {
            color: #2e7d32;
            margin-top: 0;
        }
        .recommendations ul {
            margin: 10px 0;
        }
        .recommendations li {
            margin: 8px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        tr:hover {
            background: #f5f5f5;
        }
        .metric {
            display: inline-block;
            background: #f0f0f0;
            padding: 5px 10px;
            border-radius: 5px;
            margin: 5px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <header>
        <h1>IDP Pipeline Code Quality Audit</h1>
        <div class="subtitle">Comprehensive analysis of code quality issues and dead code</div>
        <div style="margin-top: 10px; opacity: 0.8;">Generated: December 25, 2025</div>
    </header>

    <div class="summary">
        <h2>Executive Summary</h2>
        <p><strong>Status:</strong> The IDP Pipeline codebase is <span style="color: #e67e22; font-weight: bold;">MODERATELY HEALTHY</span> with several areas requiring attention.</p>
        <p><strong>Total Issues Found:</strong> <span class="metric">47 issues</span> across 7 files</p>
        <p><strong>Critical Issues:</strong> <span class="metric" style="background: #ffe6e6;">2</span> (Memory management, unused imports)</p>
        <p><strong>Lines of Code Analyzed:</strong> <span class="metric">~4,100 lines</span></p>
    </div>

    <div class="severity-grid">
        <div class="severity-card severity-critical">
            <h3>ðŸ”´ CRITICAL</h3>
            <div class="severity-count">2</div>
            <p>Must fix before deployment</p>
        </div>
        <div class="severity-card severity-high">
            <h3>ðŸŸ  HIGH</h3>
            <div class="severity-count">12</div>
            <p>Should fix soon</p>
        </div>
        <div class="severity-card severity-medium">
            <h3>ðŸŸ¡ MEDIUM</h3>
            <div class="severity-count">18</div>
            <p>Technical debt to address</p>
        </div>
        <div class="severity-card severity-low">
            <h3>ðŸ”µ LOW</h3>
            <div class="severity-count">15</div>
            <p>Code quality improvements</p>
        </div>
    </div>

    <!-- OCR ENGINE -->
    <div class="file-section">
        <h2>ðŸ“„ models/ocr_engine.py (1,907 lines)</h2>

        <div class="issue issue-critical">
            <div class="issue-header">
                <div class="issue-title">Logger Used Before Definition</div>
                <span class="severity-badge badge-critical">CRITICAL</span>
            </div>
            <div class="location">Lines 39, 47</div>
            <div class="description">
                Logger is used in exception handlers BEFORE it's defined on line 50. This will cause NameError if imports fail.
            </div>
            <div class="code-snippet">logger.warning("Visual extractor not available...")  # Line 39
logger.warning("Document analyzer not available...")  # Line 47
# Logger defined here:
logger = logging.getLogger(__name__)  # Line 50</div>
            <div class="action">
                <strong>Action:</strong> Move logger initialization to line 22 (right after logging.basicConfig)
            </div>
        </div>

        <div class="issue issue-high">
            <div class="issue-header">
                <div class="issue-title">Unused Import: sys</div>
                <span class="severity-badge badge-high">HIGH</span>
            </div>
            <div class="location">Line 9</div>
            <div class="description">
                'sys' module is imported but never used in the file. While Path.parent.parent is used for path manipulation, sys itself is not utilized.
            </div>
            <div class="action">
                <strong>Action:</strong> Remove 'import sys' from line 9
            </div>
        </div>

        <div class="issue issue-high">
            <div class="issue-header">
                <div class="issue-title">Duplicate Import Patterns</div>
                <span class="severity-badge badge-high">HIGH</span>
            </div>
            <div class="location">Multiple locations</div>
            <div class="description">
                PyTorch ('import torch') and PIL ('from PIL import Image') are imported multiple times inside methods rather than at module level. This creates redundant imports on every function call.
            </div>
            <div class="action">
                <strong>Action:</strong> Move to conditional module-level imports (after try-except block) to load once
            </div>
        </div>

        <div class="issue issue-medium">
            <div class="issue-header">
                <div class="issue-title">Hardcoded Magic Numbers</div>
                <span class="severity-badge badge-medium">MEDIUM</span>
            </div>
            <div class="location">Lines 202, 216, 358, 498</div>
            <div class="description">
                Multiple magic numbers scattered throughout:
                <ul>
                    <li>max_new_tokens=4096 (repeated 3 times)</li>
                    <li>MIN_CHARS_PER_PAGE = 50</li>
                    <li>Image coverage threshold 0.3, 0.7</li>
                    <li>Estimated processing times (0.05, 10.0, 12.0 seconds)</li>
                </ul>
            </div>
            <div class="action">
                <strong>Action:</strong> Create a CONFIG section at module level with named constants
            </div>
        </div>

        <div class="issue issue-medium">
            <div class="issue-header">
                <div class="issue-title">Commented-Out Code Block</div>
                <span class="severity-badge badge-medium">MEDIUM</span>
            </div>
            <div class="location">Lines 849</div>
            <div class="description">
                Exception handling with bare 'pass' statement - swallows errors silently without logging.
            </div>
            <div class="code-snippet">except Exception:
    pass  # Some images may not have extractable bounds</div>
            <div class="action">
                <strong>Action:</strong> Add logger.debug() to track silent failures for debugging
            </div>
        </div>

        <div class="issue issue-low">
            <div class="issue-header">
                <div class="issue-title">Inconsistent String Formatting</div>
                <span class="severity-badge badge-low">LOW</span>
            </div>
            <div class="location">Throughout file</div>
            <div class="description">
                Mix of f-strings, .format(), and % formatting. Should standardize on f-strings for Python 3.6+.
            </div>
            <div class="action">
                <strong>Action:</strong> Convert all string formatting to f-strings for consistency
            </div>
        </div>

        <div class="issue issue-low">
            <div class="issue-header">
                <div class="issue-title">Large Method: process_mixed_pdf</div>
                <span class="severity-badge badge-low">LOW</span>
            </div>
            <div class="location">Lines 1050-1217 (167 lines)</div>
            <div class="description">
                Violates Single Responsibility Principle. Handles page analysis, text extraction, OCR, hybrid merging, and result building.
            </div>
            <div class="action">
                <strong>Action:</strong> Extract methods: _extract_page_digital(), _extract_page_ocr(), _merge_hybrid_content()
            </div>
        </div>
    </div>

    <!-- VISUAL EXTRACTOR -->
    <div class="file-section">
        <h2>ðŸ“„ models/visual_extractor.py (1,121 lines)</h2>

        <div class="issue issue-high">
            <div class="issue-header">
                <div class="issue-title">Dead Code: AI Analysis Methods</div>
                <span class="severity-badge badge-high">HIGH</span>
            </div>
            <div class="location">Lines 889-1001</div>
            <div class="description">
                Three placeholder methods that always return None and contain only "# Placeholder" comments:
                <ul>
                    <li>_analyze_diagram_with_ai() (line 889)</li>
                    <li>_analyze_chart_with_ai() (line 966)</li>
                    <li>Diagram/chart detection methods (detect_diagrams, detect_charts)</li>
                </ul>
            </div>
            <div class="action">
                <strong>Action:</strong> Either implement functionality or mark as @abstractmethod with NotImplementedError for future implementation
            </div>
        </div>

        <div class="issue issue-high">
            <div class="issue-header">
                <div class="issue-title">Unused Class Variables</div>
                <span class="severity-badge badge-high">HIGH</span>
            </div>
            <div class="location">Lines 619-620</div>
            <div class="description">
                Instance variables _vision_model and _cascade_model are initialized to None but never assigned or used anywhere in the class.
            </div>
            <div class="action">
                <strong>Action:</strong> Remove unused variables or implement lazy loading for future vision model integration
            </div>
        </div>

        <div class="issue issue-medium">
            <div class="issue-header">
                <div class="issue-title">Incomplete AI Cascade System</div>
                <span class="severity-badge badge-medium">MEDIUM</span>
            </div>
            <div class="location">Lines 1007-1049</div>
            <div class="description">
                escalate_extraction() method has complete logic but commented-out actual escalation code (lines 1040-1042). Returns original result without trying cascade.
            </div>
            <div class="action">
                <strong>Action:</strong> Either implement full cascade or remove method and add TODO marker
            </div>
        </div>

        <div class="issue issue-medium">
            <div class="issue-header">
                <div class="issue-title">Copy-Paste Code: Cell Type Inference</div>
                <span class="severity-badge badge-medium">MEDIUM</span>
            </div>
            <div class="location">Lines 785-826</div>
            <div class="description">
                Similar try-except pattern repeated for currency, percentage, and number detection. Can be DRYed.
            </div>
            <div class="action">
                <strong>Action:</strong> Create _try_parse_numeric(value, pattern, cell_type) helper method
            </div>
        </div>

        <div class="issue issue-low">
            <div class="issue-header">
                <div class="issue-title">Hardcoded Regex Patterns</div>
                <span class="severity-badge badge-low">LOW</span>
            </div>
            <div class="location">Lines 590-607</div>
            <div class="description">
                Currency, percentage, and date patterns defined as class variables but could be constants at module level for reusability.
            </div>
            <div class="action">
                <strong>Action:</strong> Move to module-level constants or separate patterns.py config file
            </div>
        </div>
    </div>

    <!-- DOCUMENT ANALYZER -->
    <div class="file-section">
        <h2>ðŸ“„ models/doc_analyzer.py (629 lines)</h2>

        <div class="issue issue-high">
            <div class="issue-header">
                <div class="issue-title">Massive Stopwords Dictionary</div>
                <span class="severity-badge badge-high">HIGH</span>
            </div>
            <div class="location">Lines 26-63</div>
            <div class="description">
                Two large stopwords sets (STOPWORDS_FR with 100+ words, STOPWORDS_EN with 80+ words) hardcoded in Python. This bloats the module and makes updates difficult.
            </div>
            <div class="action">
                <strong>Action:</strong> Move to external JSON/YAML file: config/stopwords.json. Load dynamically.
            </div>
        </div>

        <div class="issue issue-high">
            <div class="issue-header">
                <div class="issue-title">Hardcoded Document Type Indicators</div>
                <span class="severity-badge badge-high">HIGH</span>
            </div>
            <div class="location">Lines 89-136</div>
            <div class="description">
                Large DOC_TYPE_INDICATORS dictionary (47 lines) hardcoded with keyword lists for each document type. Not maintainable.
            </div>
            <div class="action">
                <strong>Action:</strong> Move to config/document_types.yaml for easy updates without code changes
            </div>
        </div>

        <div class="issue issue-medium">
            <div class="issue-header">
                <div class="issue-title">Unused Function Parameter</div>
                <span class="severity-badge badge-medium">MEDIUM</span>
            </div>
            <div class="location">Line 207 - analyze() method</div>
            <div class="description">
                Parameter 'full_text' is accepted but never used differently from 'text'. Logic: analysis_text = full_text or text - but full_text is optional and defaults to None.
            </div>
            <div class="action">
                <strong>Action:</strong> Remove full_text parameter or document its intended use case
            </div>
        </div>

        <div class="issue issue-medium">
            <div class="issue-header">
                <div class="issue-title">Magic Number: Sentence Scoring</div>
                <span class="severity-badge badge-medium">MEDIUM</span>
            </div>
            <div class="location">Lines 305-342</div>
            <div class="description">
                Multiple hardcoded scoring weights in _score_sentence():
                <ul>
                    <li>Position bonus: 2.0, 0.5</li>
                    <li>Keyword frequency multiplier: 0.1</li>
                    <li>Length bonus: 1.0 for 10-30 words</li>
                    <li>Number presence: +0.5</li>
                </ul>
            </div>
            <div class="action">
                <strong>Action:</strong> Create SCORING_WEIGHTS config dictionary at class level
            </div>
        </div>

        <div class="issue issue-low">
            <div class="issue-header">
                <div class="issue-title">Regex Compilation in Loops</div>
                <span class="severity-badge badge-low">LOW</span>
            </div>
            <div class="location">Lines 349-355, 813-815</div>
            <div class="description">
                Regex patterns compiled/searched inside loops (e.g., bullet_pattern, numbered_pattern). Should be compiled once as class/module constants.
            </div>
            <div class="action">
                <strong>Action:</strong> Pre-compile as class constants: BULLET_PATTERN = re.compile(r'...')
            </div>
        </div>
    </div>

    <!-- ORGANIZER ENGINE -->
    <div class="file-section">
        <h2>ðŸ“„ models/organizer_engine.py (539 lines)</h2>

        <div class="issue issue-high">
            <div class="issue-header">
                <div class="issue-title">Duplicate JSON Extraction Logic</div>
                <span class="severity-badge badge-high">HIGH</span>
            </div>
            <div class="location">Lines 179-203 (Qwen), 271-280 (Llama)</div>
            <div class="description">
                Two nearly identical _extract_json() methods in QwenOrganizerEngine and LlamaOrganizerEngine. Violates DRY principle.
            </div>
            <div class="action">
                <strong>Action:</strong> Move to BaseOrganizerEngine as shared method
            </div>
        </div>

        <div class="issue issue-medium">
            <div class="issue-header">
                <div class="issue-title">Unused Parameter: enhanced_ocr_data</div>
                <span class="severity-badge badge-medium">MEDIUM</span>
            </div>
            <div class="location">Line 378 - process() method</div>
            <div class="description">
                Parameter 'enhanced_ocr_data' is accepted but never used in the method body. Only used in process_enhanced().
            </div>
            <div class="action">
                <strong>Action:</strong> Remove unused parameter from process() signature
            </div>
        </div>

        <div class="issue issue-medium">
            <div class="issue-header">
                <div class="issue-title">Hardcoded Prompt Templates</div>
                <span class="severity-badge badge-medium">MEDIUM</span>
            </div>
            <div class="location">Lines 138-177, 244-252, 317</div>
            <div class="description">
                Long prompt templates hardcoded in methods. Makes prompt engineering difficult without code changes.
            </div>
            <div class="action">
                <strong>Action:</strong> Move to config/prompts.yaml or templates/ directory
            </div>
        </div>

        <div class="issue issue-low">
            <div class="issue-header">
                <div class="issue-title">Text Truncation Without Warning</div>
                <span class="severity-badge badge-low">LOW</span>
            </div>
            <div class="location">Lines 152, 249, 249</div>
            <div class="description">
                Text silently truncated to 6000-8000 chars for different models. User not warned about data loss.
            </div>
            <div class="action">
                <strong>Action:</strong> Log warning when truncation occurs: logger.warning(f"Text truncated: {len(text)} > {limit}")
            </div>
        </div>
    </div>

    <!-- PIPELINE -->
    <div class="file-section">
        <h2>ðŸ“„ api/pipeline.py (466 lines)</h2>

        <div class="issue issue-critical">
            <div class="issue-header">
                <div class="issue-title">Memory Management Sleep Timing</div>
                <span class="severity-badge badge-critical">CRITICAL</span>
            </div>
            <div class="location">Line 235</div>
            <div class="description">
                Hardcoded 2-second sleep for memory cleanup. This is a production reliability risk:
                <ul>
                    <li>Too short: Memory not reclaimed on slow systems</li>
                    <li>Too long: Wastes processing time</li>
                    <li>No verification that memory was actually freed</li>
                </ul>
            </div>
            <div class="code-snippet">time.sleep(2)  # Give system time to reclaim memory</div>
            <div class="action">
                <strong>Action:</strong> Make configurable via IDP_CLEANUP_SLEEP_SECONDS env var. Add memory verification loop with timeout.
            </div>
        </div>

        <div class="issue issue-high">
            <div class="issue-header">
                <div class="issue-title">Unused Imports</div>
                <span class="severity-badge badge-high">HIGH</span>
            </div>
            <div class="location">Lines 19-20</div>
            <div class="description">
                Two unused imports:
                <ul>
                    <li>logging - imported but never used (no logger defined)</li>
                    <li>threading - imported but only PipelineWorkerThread is defined, not used in main pipeline</li>
                </ul>
            </div>
            <div class="action">
                <strong>Action:</strong> Remove unused imports or add logger initialization
            </div>
        </div>

        <div class="issue issue-medium">
            <div class="issue-header">
                <div class="issue-title">God Method: process_job</div>
                <span class="severity-badge badge-medium">MEDIUM</span>
            </div>
            <div class="location">Lines 119-337 (218 lines)</div>
            <div class="description">
                Massive method handling 5 stages: file analysis, model selection, model loading, OCR, organization, and saving. Violates SRP.
            </div>
            <div class="action">
                <strong>Action:</strong> Extract methods: _analyze_and_select(), _load_models(), _run_ocr(), _organize(), _save_results()
            </div>
        </div>

        <div class="issue issue-medium">
            <div class="issue-header">
                <div class="issue-title">Duplicate Code: Compact JSON Generation</div>
                <span class="severity-badge badge-medium">MEDIUM</span>
            </div>
            <div class="location">Lines 278-318</div>
            <div class="description">
                Complex compact JSON generation logic embedded in process_job. Should be extracted to separate method for reuse and testing.
            </div>
            <div class="action">
                <strong>Action:</strong> Create _generate_compact_output(final_result) method
            </div>
        </div>

        <div class="issue issue-low">
            <div class="issue-header">
                <div class="issue-title">Hardcoded Progress Percentages</div>
                <span class="severity-badge badge-low">LOW</span>
            </div>
            <div class="location">Lines 141-329</div>
            <div class="description">
                Progress percentages hardcoded throughout (0.05, 0.1, 0.15, 0.55, 0.6, 0.95, 1.0). Hard to maintain if pipeline stages change.
            </div>
            <div class="action">
                <strong>Action:</strong> Create PIPELINE_STAGES dict with stage names and weights
            </div>
        </div>
    </div>

    <!-- CONFIG FILES -->
    <div class="file-section">
        <h2>ðŸ“„ config/intermediate_format.py (606 lines)</h2>

        <div class="issue issue-medium">
            <div class="issue-header">
                <div class="issue-title">Duplicate Enum Handling Logic</div>
                <span class="severity-badge badge-medium">MEDIUM</span>
            </div>
            <div class="location">Lines 580-592</div>
            <div class="description">
                Custom serialize() function for enum handling in to_json(). Similar logic could be reused across multiple dataclasses.
            </div>
            <div class="action">
                <strong>Action:</strong> Create utils/serialization.py with shared serialize_dataclass() function
            </div>
        </div>

        <div class="issue issue-low">
            <div class="issue-header">
                <div class="issue-title">Unused Dataclass Fields</div>
                <span class="severity-badge badge-low">LOW</span>
            </div>
            <div class="location">Various dataclasses</div>
            <div class="description">
                Several optional fields in dataclasses that are never populated in actual code:
                <ul>
                    <li>TextElement.font_size (line 39)</li>
                    <li>TextElement.is_bold, is_italic (lines 40-41)</li>
                    <li>BoundingBox used inconsistently</li>
                </ul>
            </div>
            <div class="action">
                <strong>Action:</strong> Either implement or mark as FUTURE_FEATURE for v3.0
            </div>
        </div>
    </div>

    <div class="file-section">
        <h2>ðŸ“„ config/models_config.py (339 lines)</h2>

        <div class="issue issue-low">
            <div class="issue-header">
                <div class="issue-title">Unused Function</div>
                <span class="severity-badge badge-low">LOW</span>
            </div>
            <div class="location">Lines 326-338 - print_download_commands()</div>
            <div class="description">
                Function defined but never called anywhere in the codebase. Dead code for documentation purposes.
            </div>
            <div class="action">
                <strong>Action:</strong> Move to separate CLI utility: scripts/download_models.py or remove if not needed
            </div>
        </div>

        <div class="issue issue-low">
            <div class="issue-header">
                <div class="issue-title">Missing Model Entry</div>
                <span class="severity-badge badge-low">LOW</span>
            </div>
            <div class="location">Line 311</div>
            <div class="description">
                RECOMMENDED_CONFIG references "surya_ocr" for ocr_speed, but there's no engine implementation for surya_ocr in ENGINE_MAP (ocr_engine.py line 464-471).
            </div>
            <div class="action">
                <strong>Action:</strong> Change ocr_speed to "florence2_large" (has engine) or implement SuryaOCREngine
            </div>
        </div>
    </div>

    <!-- RECOMMENDATIONS -->
    <div class="recommendations">
        <h3>Priority Cleanup Actions</h3>
        <ol>
            <li><strong>CRITICAL - Fix Logger Initialization Order (ocr_engine.py)</strong>
                <ul>
                    <li>Move logger = logging.getLogger(__name__) to line 22</li>
                    <li>Prevents NameError if import exceptions occur</li>
                </ul>
            </li>
            <li><strong>CRITICAL - Make Memory Cleanup Configurable (pipeline.py)</strong>
                <ul>
                    <li>Replace time.sleep(2) with configurable env var</li>
                    <li>Add memory verification loop</li>
                    <li>Critical for production reliability</li>
                </ul>
            </li>
            <li><strong>HIGH - Remove Dead AI Methods (visual_extractor.py)</strong>
                <ul>
                    <li>Either implement diagram/chart AI analysis OR</li>
                    <li>Remove methods and add TODO for future implementation</li>
                </ul>
            </li>
            <li><strong>HIGH - Extract Stopwords and Doc Types to Config (doc_analyzer.py)</strong>
                <ul>
                    <li>Create config/stopwords.json (saves ~100 lines)</li>
                    <li>Create config/document_types.yaml (saves ~50 lines)</li>
                    <li>Makes updates possible without code changes</li>
                </ul>
            </li>
            <li><strong>MEDIUM - Consolidate Duplicate Code</strong>
                <ul>
                    <li>Merge _extract_json() methods into BaseOrganizerEngine</li>
                    <li>Extract _try_parse_numeric() in visual_extractor.py</li>
                    <li>Create shared serialization utilities</li>
                </ul>
            </li>
        </ol>

        <h3>Code Quality Improvements</h3>
        <ul>
            <li><strong>Import Optimization:</strong> Move repeated imports (torch, PIL.Image) to module level with lazy loading</li>
            <li><strong>Magic Numbers:</strong> Create CONFIG dictionaries for all hardcoded values</li>
            <li><strong>Regex Compilation:</strong> Pre-compile all regex patterns as module/class constants</li>
            <li><strong>Method Extraction:</strong> Break down large methods (process_mixed_pdf, process_job) into smaller focused methods</li>
            <li><strong>String Formatting:</strong> Standardize on f-strings throughout codebase</li>
            <li><strong>Empty Exception Handlers:</strong> Add logging to all "pass" exception handlers for debugging</li>
        </ul>

        <h3>Estimated Cleanup Effort</h3>
        <table>
            <thead>
                <tr>
                    <th>Priority</th>
                    <th>Issues</th>
                    <th>Estimated Hours</th>
                    <th>Impact</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Critical</strong></td>
                    <td>2 issues</td>
                    <td>2-3 hours</td>
                    <td>High - Production stability</td>
                </tr>
                <tr>
                    <td><strong>High</strong></td>
                    <td>12 issues</td>
                    <td>8-12 hours</td>
                    <td>High - Maintainability</td>
                </tr>
                <tr>
                    <td><strong>Medium</strong></td>
                    <td>18 issues</td>
                    <td>12-16 hours</td>
                    <td>Medium - Code quality</td>
                </tr>
                <tr>
                    <td><strong>Low</strong></td>
                    <td>15 issues</td>
                    <td>6-8 hours</td>
                    <td>Low - Polish</td>
                </tr>
                <tr>
                    <td colspan="2"><strong>Total Cleanup</strong></td>
                    <td><strong>28-39 hours</strong></td>
                    <td>~1 sprint (2 weeks)</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div style="background: #fff; padding: 20px; border-radius: 10px; margin-top: 30px; text-align: center; color: #666;">
        <p><strong>Audit Completed:</strong> December 25, 2025</p>
        <p>Generated by Claude Code Review Agent</p>
        <p style="margin-top: 15px; font-size: 0.9em;">Next Steps: Create GitHub issues for Critical/High priority items and schedule cleanup sprint</p>
    </div>
</body>
</html>