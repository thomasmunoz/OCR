<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDP Pipeline - Scalable Docker Architecture</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: linear-gradient(135deg, #0a0a14 0%, #1a1a2e 50%, #0f2744 100%);
            min-height: 100vh;
            color: #e0e0e0;
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }

        header {
            text-align: center;
            padding: 3rem 2rem;
            background: linear-gradient(135deg, rgba(239,68,68,0.2), rgba(124,58,237,0.2));
            border-radius: 20px;
            margin-bottom: 2rem;
            border: 1px solid rgba(239,68,68,0.3);
        }
        h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, #ef4444, #7c3aed, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }
        .subtitle { color: #a0a0a0; font-size: 1.2rem; }

        .badges { margin-top: 1.5rem; display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; }
        .badge { padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
        .badge-red { background: rgba(239,68,68,0.2); color: #f87171; border: 1px solid #ef4444; }
        .badge-green { background: rgba(16,185,129,0.2); color: #10b981; border: 1px solid #10b981; }
        .badge-blue { background: rgba(59,130,246,0.2); color: #3b82f6; border: 1px solid #3b82f6; }

        section {
            background: rgba(255,255,255,0.03);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255,255,255,0.08);
        }
        section h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: #ef4444;
        }

        .mermaid {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            overflow-x: auto;
        }

        pre, code {
            background: rgba(0,0,0,0.4);
            font-family: 'SF Mono', Monaco, monospace;
            border-radius: 8px;
        }
        pre { padding: 1.5rem; overflow-x: auto; font-size: 0.9rem; }
        code { padding: 0.2rem 0.5rem; font-size: 0.9rem; color: #10b981; }

        .command-box {
            background: linear-gradient(135deg, rgba(16,185,129,0.2), rgba(6,182,212,0.2));
            border: 1px solid #10b981;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        .command-box h3 { color: #10b981; margin-bottom: 1rem; }
        .command-box code {
            display: block;
            background: rgba(0,0,0,0.4);
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            font-size: 1.1rem;
        }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; }

        .card {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .card h4 { color: #06b6d4; margin-bottom: 0.5rem; font-size: 1.1rem; }
        .card p { color: #a0a0a0; font-size: 0.9rem; }

        table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
        th, td { padding: 1rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { color: #6b7280; font-weight: 500; font-size: 0.85rem; text-transform: uppercase; }

        .highlight { background: linear-gradient(135deg, rgba(239,68,68,0.1), rgba(124,58,237,0.1)); }

        .step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin: 1.5rem 0;
            padding: 1rem;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        .step-num {
            background: linear-gradient(135deg, #ef4444, #7c3aed);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        .step-content h4 { margin-bottom: 0.3rem; color: #e0e0e0; }
        .step-content p { color: #a0a0a0; font-size: 0.9rem; }

        footer {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Scalable Docker Architecture</h1>
            <p class="subtitle">IDP Pipeline - Horizontal Scaling with Containers</p>
            <div class="badges">
                <span class="badge badge-red">Docker Compose</span>
                <span class="badge badge-green">Auto-Scaling</span>
                <span class="badge badge-blue">GPU Support</span>
            </div>
        </header>

        <!-- One Command -->
        <section class="highlight">
            <h2>One Command Control</h2>
            <div class="command-box">
                <h3>Start / Stop / Scale</h3>
                <code>./idp-docker</code>
                <code>./idp-docker up 3</code>
                <code>./idp-docker scale 5</code>
                <code>./idp-docker gpu 2</code>
                <code>./idp-docker down</code>
            </div>
        </section>

        <!-- Architecture -->
        <section>
            <h2>Scalable Architecture</h2>
            <div class="mermaid">
flowchart TB
    subgraph Client["Client Layer"]
        browser["Browser"]
        cli["CLI"]
        extApi["External API"]
    end

    subgraph LB["Load Balancer"]
        nginx["Nginx / Traefik"]
    end

    subgraph API["API Layer"]
        api1["API Container"]
    end

    subgraph Queue["Queue Layer"]
        redis[("Redis")]
    end

    subgraph Workers["Worker Pool (Scalable)"]
        w1["Worker 1"]
        w2["Worker 2"]
        w3["Worker N..."]
    end

    subgraph Storage["Shared Storage"]
        uploads[("Uploads Volume")]
        output[("Output Volume")]
        models[("Models Volume")]
    end

    browser --> nginx
    cli --> nginx
    extApi --> nginx
    nginx --> api1

    api1 --> redis
    redis --> w1
    redis --> w2
    redis --> w3

    w1 --> uploads
    w1 --> output
    w1 --> models
    w2 --> uploads
    w2 --> output
    w2 --> models
    w3 --> uploads
    w3 --> output
    w3 --> models
            </div>
        </section>

        <!-- Container Details -->
        <section>
            <h2>Container Services</h2>
            <div class="mermaid">
graph LR
    subgraph Docker["Docker Compose Stack"]
        subgraph redis_svc["Redis Service"]
            redis["redis:7-alpine"]
        end

        subgraph api_svc["API Service"]
            api["idp-api:latest"]
        end

        subgraph worker_svc["Worker Service x N"]
            worker["idp-worker:latest"]
        end

        subgraph monitor_svc["Monitor (Optional)"]
            flower["flower:2.0"]
        end
    end

    redis_svc --> api_svc
    redis_svc --> worker_svc
    redis_svc --> monitor_svc
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>Image</th>
                        <th>Port</th>
                        <th>Scalable</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>redis</code></td>
                        <td>redis:7-alpine</td>
                        <td>6379</td>
                        <td>No</td>
                        <td>Distributed job queue</td>
                    </tr>
                    <tr>
                        <td><code>api</code></td>
                        <td>idp-api</td>
                        <td>8080</td>
                        <td>Yes*</td>
                        <td>Dashboard, REST API, file upload</td>
                    </tr>
                    <tr>
                        <td><code>worker</code></td>
                        <td>idp-worker</td>
                        <td>-</td>
                        <td>Yes</td>
                        <td>OCR and organization processing</td>
                    </tr>
                    <tr>
                        <td><code>monitor</code></td>
                        <td>flower:2.0</td>
                        <td>5555</td>
                        <td>No</td>
                        <td>Worker monitoring UI</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Scaling Flow -->
        <section>
            <h2>Auto-Scaling Flow</h2>
            <div class="mermaid">
sequenceDiagram
    participant U as User
    participant A as API
    participant R as Redis Queue
    participant W1 as Worker 1
    participant W2 as Worker 2
    participant W3 as Worker 3

    U->>A: Upload 10 files
    A->>R: Queue 10 jobs

    par Parallel Processing
        R->>W1: Job 1, 4, 7, 10
        R->>W2: Job 2, 5, 8
        R->>W3: Job 3, 6, 9
    end

    W1-->>R: Complete
    W2-->>R: Complete
    W3-->>R: Complete

    R-->>A: All done
    A-->>U: Results ready
            </div>
        </section>

        <!-- Quick Start -->
        <section class="highlight">
            <h2>Quick Start Guide</h2>

            <div class="step">
                <div class="step-num">1</div>
                <div class="step-content">
                    <h4>Clone and Enter Directory</h4>
                    <p><code>cd idp_pipeline</code></p>
                </div>
            </div>

            <div class="step">
                <div class="step-num">2</div>
                <div class="step-content">
                    <h4>Start with Docker (One Command)</h4>
                    <p><code>./idp-docker</code></p>
                </div>
            </div>

            <div class="step">
                <div class="step-num">3</div>
                <div class="step-content">
                    <h4>Open Dashboard</h4>
                    <p>Navigate to <code>http://localhost:8080</code></p>
                </div>
            </div>

            <div class="step">
                <div class="step-num">4</div>
                <div class="step-content">
                    <h4>Scale Workers as Needed</h4>
                    <p><code>./idp-docker scale 5</code></p>
                </div>
            </div>
        </section>

        <!-- Commands Reference -->
        <section>
            <h2>Command Reference</h2>
            <pre>./idp-docker                  # Start with 1 worker
./idp-docker up 3             # Start with 3 workers
./idp-docker gpu              # Start with GPU support
./idp-docker gpu 2            # Start with 2 GPU workers
./idp-docker scale 5          # Scale to 5 workers (live)
./idp-docker status           # Show container status
./idp-docker logs             # Stream all logs
./idp-docker logs worker      # Stream worker logs only
./idp-docker down             # Stop everything
./idp-docker clean            # Remove all data and volumes
./idp-docker models           # Download AI models</pre>
        </section>

        <!-- File Structure -->
        <section>
            <h2>Docker File Structure</h2>
            <pre>idp_pipeline/
├── Dockerfile                 # Multi-stage build (CPU + GPU)
├── docker-compose.yml         # Standard compose (CPU)
├── docker-compose.gpu.yml     # GPU-enabled compose
├── .dockerignore              # Build exclusions
├── idp-docker                 # One-command control script
│
├── docker/
│   └── requirements-docker.txt  # Additional Docker deps
│
└── volumes/
    ├── uploads/               # Mounted upload storage
    ├── output/                # Mounted output storage
    └── models/                # Mounted model cache</pre>
        </section>

        <!-- Environment Variables -->
        <section>
            <h2>Environment Configuration</h2>
            <table>
                <thead>
                    <tr>
                        <th>Variable</th>
                        <th>Default</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>IDP_QUEUE_TYPE</code></td>
                        <td>redis</td>
                        <td>Queue backend (redis/sqlite)</td>
                    </tr>
                    <tr>
                        <td><code>IDP_REDIS_URL</code></td>
                        <td>redis://redis:6379/0</td>
                        <td>Redis connection URL</td>
                    </tr>
                    <tr>
                        <td><code>IDP_UPLOAD_DIR</code></td>
                        <td>/data/uploads</td>
                        <td>Upload directory</td>
                    </tr>
                    <tr>
                        <td><code>IDP_OUTPUT_DIR</code></td>
                        <td>/data/output</td>
                        <td>Output directory</td>
                    </tr>
                    <tr>
                        <td><code>IDP_MODELS_DIR</code></td>
                        <td>/data/models</td>
                        <td>Model cache directory</td>
                    </tr>
                    <tr>
                        <td><code>IDP_PORT</code></td>
                        <td>8080</td>
                        <td>API server port</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- GPU Support -->
        <section>
            <h2>GPU Support (NVIDIA)</h2>
            <div class="grid">
                <div class="card">
                    <h4>Requirements</h4>
                    <p>NVIDIA GPU with CUDA support</p>
                    <p>nvidia-docker2 installed</p>
                    <p>CUDA 12.1+ drivers</p>
                </div>
                <div class="card">
                    <h4>Start GPU Mode</h4>
                    <p><code>./idp-docker gpu</code></p>
                    <p>or</p>
                    <p><code>./idp-docker gpu 2</code></p>
                </div>
                <div class="card">
                    <h4>Verify GPU</h4>
                    <p><code>docker compose -f docker-compose.gpu.yml exec worker-gpu nvidia-smi</code></p>
                </div>
            </div>
        </section>

        <!-- Portability -->
        <section class="highlight">
            <h2>Portability</h2>
            <div class="grid">
                <div class="card">
                    <h4>Transfer to Another System</h4>
                    <p>1. Copy <code>idp_pipeline/</code> folder</p>
                    <p>2. Run <code>./idp-docker</code></p>
                    <p>3. Done!</p>
                </div>
                <div class="card">
                    <h4>Export as Tarball</h4>
                    <p><code>tar -czvf idp-pipeline.tar.gz idp_pipeline/</code></p>
                </div>
                <div class="card">
                    <h4>Push to Registry</h4>
                    <p><code>docker compose build</code></p>
                    <p><code>docker tag idp-api your-registry/idp-api</code></p>
                    <p><code>docker push your-registry/idp-api</code></p>
                </div>
            </div>
        </section>

        <!-- Health Checks -->
        <section>
            <h2>Health Monitoring</h2>
            <div class="mermaid">
flowchart LR
    subgraph Endpoints["Health Endpoints"]
        health["/health"]
        ready["/ready"]
        stats["/api/stats"]
    end

    subgraph Checks["What They Check"]
        api_check["API Status"]
        redis_check["Redis Connection"]
        queue_check["Queue Stats"]
    end

    health --> api_check
    health --> redis_check
    ready --> api_check
    stats --> queue_check
            </div>

            <pre># Check API health
curl http://localhost:8080/health

# Check readiness
curl http://localhost:8080/ready

# Get queue stats
curl http://localhost:8080/api/stats</pre>
        </section>

        <footer>
            <p>IDP Pipeline - Scalable Docker Architecture</p>
            <p style="margin-top:0.5rem;">Generated: December 25, 2025 | Oracle ULTRATHINK</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#ef4444',
                primaryTextColor: '#e0e0e0',
                primaryBorderColor: '#b91c1c',
                lineColor: '#6b7280',
                secondaryColor: '#7c3aed',
                tertiaryColor: '#0f172a',
                background: '#0f0f1a',
                mainBkg: '#1a1a2e'
            }
        });
    </script>
</body>
</html>
